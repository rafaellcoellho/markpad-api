# version: 2.0
# jobs:
#   build:
#     docker:
#       - image: tiangolo/uvicorn-gunicorn-fastapi:python3.6
#     working_directory: ~/markpad
#     steps:
#       - checkout
#       - run: cat test.env > .env
#       - run: ls
#       - run: cat tests/test_main.py
#       - setup_remote_docker:
#           docker_layer_caching: true
#       - run:
#           name: Install Docker client
#           command: |
#             set -x
#             VER="17.03.0-ce"
#             curl -L -o /tmp/docker-$VER.tgz https://download.docker.com/linux/static/stable/x86_64/docker-$VER.tgz
#             tar -xz -C /tmp -f /tmp/docker-$VER.tgz
#             mv /tmp/docker/* /usr/bin
#       - run:
#           name: Install Docker Compose
#           command: |
#             set -x
#             curl -L https://github.com/docker/compose/releases/download/1.11.2/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
#             chmod +x /usr/local/bin/docker-compose
#       - run: 
#           name: Start Container 
#           command: |
#             set -x
#             docker-compose run test 
version: 2.0
jobs:
  build:
    docker:
      - image: tiangolo/uvicorn-gunicorn-fastapi:python3.6
        enviroment:
          MONGO_URI='mongodb://root@localhost'
          MONGO_DATABASE_NAME='markpad_tests'
      - image: circleci/mongo:4.0.9
    working_directory: ~/markpad
    steps:
      - checkout
      - run: pip install --upgrade pip
      - run: pip install --no-cache-dir -r requirements.txt
      - save_cache:
          key: deps1-{{ .Branch }}-{{ checksum "requirements.txt" }}
          paths:
            - "venv"
      - run: pytest